# CFWheels Model Generator

This tool automatically generates CFWheels model files from a SQL Server database, leveraging the MSSQL MCP Server to extract schema information and generate properly structured CFWheels components.

## Features

- Connects to SQL Server through MSSQL MCP Server
- Generates model files for all tables or a specific subset
- Creates proper CFWheels component structure with appropriate naming conventions
- Automatically detects and configures:
  - Table names and primary keys
  - Validations based on column constraints (required, data types, length)
  - Relationships (`belongsTo`, `hasMany`) from foreign key definitions
- Adds comprehensive property documentation with types
- Handles timestamp fields (`createdAt`, `updatedAt`)

## Prerequisites

1. Running MSSQL MCP Server (by default at http://localhost:3333)
2. Node.js 14+ installed
3. SQL Server connection configured in your environment

## Configuration

Create a `.env` file with the following variables or set them in your environment:

```
# Server configuration
SERVER_URL=http://localhost:3333
DEBUG=false

# Database connection (used by MCP server)
DB_SERVER=localhost
DB_PORT=1433
DB_DATABASE=srp
DB_USER=sa
DB_PASSWORD=YourPassword
```

## Installation

```bash
# Clone the repository or download the script
# Install dependencies
npm install dotenv @modelcontextprotocol/sdk
```

## Usage

Run the script to generate models:

```bash
node generate-models.mjs [options]
```

### Command-Line Options

- `--output`, `-o`: Output directory for model files (default: `./output/models`)
- `--server`, `-s`: MCP Server URL (default: http://localhost:3333)
- `--debug`, `-d`: Enable debug mode
- `--tables`, `-t`: Comma-separated list of tables to process (default: all tables)
- `--exclude`, `-e`: Comma-separated list of tables to exclude
- `--help`, `-h`: Show help information

### Examples

Generate models for all tables:
```bash
node generate-models.mjs
```

Generate models for specific tables:
```bash
node generate-models.mjs --tables Individuals,Activities,Localities
```

Exclude system tables:
```bash
node generate-models.mjs --exclude sysdiagrams,DBScriptHistories
```

Set custom output directory:
```bash
node generate-models.mjs --output ./models
```

## Generated Models

The generator creates one `.cfc` file per table with the following structure:

```cfm
component extends="Model" output="false" {
  /**
   * ModelName Model
   * Generated by CFWheels Model Generator
   * Table: tableName
   */
  
  public function init() {
    // Database table configuration
    table("TableName");
    primaryKey("Id");
    
    // Timestamp columns
    property(name="createdAt", column="CreatedTimestamp");
    property(name="updatedAt", column="LastUpdatedTimestamp");

    // Associations
    belongsTo(name="RelatedModel", foreignKey="RelatedModelId");
    hasMany(name="ChildModels", foreignKey="ThisModelId");

    // Validations
    validates("Name", {required=true, maxLength=255});
    validates("Age", {numeric=true});
    
    return this;
  }

  /**
   * Properties
   */
  /**
   * @name Id
   * @type numeric
   * @nullable false
   */
  /**
   * @name Name
   * @type string
   * @nullable false
   */
  // Additional properties...
}
```

## Relationship Mapping

The generator automatically detects and configures relationships:

- **belongsTo**: Created for each foreign key in the table
- **hasMany**: Created for each table that references this table via foreign key
- **hasOne**: Created for one-to-one relationships

## Data Type Mapping

SQL Server types are mapped to appropriate CFWheels validations and property types:

| SQL Server Type | CFWheels Property Type | Validation |
|-----------------|------------------------|------------|
| int, bigint, etc. | numeric | numeric=true |
| varchar, nvarchar | string | maxLength=X |
| bit | boolean | boolean=true |
| datetime, date | datetime/date | date=true |
| uniqueidentifier | uuid | - |

## Project Structure

The generator maintains these files:

- **generate-models.mjs**: Main script
- **MODEL_GENERATOR_README.md**: Documentation
- **./output/models/**: Default output directory for model files

## Troubleshooting

- **Connection Issues**: Make sure the MSSQL MCP Server is running at the specified URL
- **Permission Errors**: Ensure your database user has SELECT permissions on all schema tables
- **Missing Relationships**: Foreign keys must be properly defined in the database schema

## License

This tool is provided under the MIT License.